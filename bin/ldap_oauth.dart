import 'dart:convert';

import 'package:shelf_plus/shelf_plus.dart';

void main() => shelfRun(init);

Handler init() {
  var app = Router().plus;

  app.get('/.well-known/openid-configuration', () => jsonEncode({}));

  app.get('/auth', () {
    // Validate client_id, redirect_uri,
    // Check query param `response_type` equals `code` or return unsupported
    // Check scopes include openid and profile
    // Create a interaction with the provided data
    // Save query param `state` to the interaction
    // Save scopes to interaction
    // Redirect user to /interaction/<interaction>/login or:
    // Redirect to authorize page directly
  });

  // app.get('/device/auth') // UNSUPPORTED FOR NOW
  app.get('/session/end', () {
    // Delete session from store
  });

  app.get('/token', () {
    // Validate client_id, client_secret, redirect_uri,
    // Validate code
    // Check query param `grant_type` equals `authorization_code` or return unsupported
    // Create token
    // Remove code, (cannot get token twice)
  });

  app.get('/me', () {
    // Validate access_token
    // Send basic user data and data from token scopes
  });

  app.get('/token/revocation', () {
    // Verify client secret and token
    // delete token
  });

  return app;
}

class Person {
  final String name;

  Person(this.name);

  // can be generated by tools (i.e. json_serializable package)
  Map<String, dynamic> toJson() => {'name': name};
}
